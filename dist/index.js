(function(c,S){typeof exports=="object"&&typeof module<"u"?S(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],S):(c=typeof globalThis<"u"?globalThis:c||self,S(c.FmmReact={},c.React))})(this,function(c,S){"use strict";function K(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var d=K(S);class A{constructor(){this.minimaps=new Set}notifyMinimapOnUpdate(t,i){i?this.minimaps.add(t):this.minimaps.delete(t)}notifyMinimaps(){const t=new Set;this.minimaps.forEach(i=>i.takeSnapshot()||t.add(i)),t.forEach(i=>this.minimaps.delete(i))}}class $ extends A{constructor(t,i){super();this.values=t,this.errors=i||{},this.values=t||{}}createStoreItem(t,i){for(const s of t.getStoreKeys(i))if(s&&s in this.values)return new J(i,s)}getError(t,i,s){const n=this.errors[i.key];return Array.isArray(n)?n.length?String(n[0]):"":n?String(n):""}getName(t,i){return i.key}getValue(t,i){return this.values[i.key]}isDisabled(t,i){return t.isDisabled(i.e)}update(t,i){this.errors=i||{},this.values=t||{},super.notifyMinimaps()}}class J{constructor(t,i){this.e=t,this.key=i}destructor(){}}const y=class{constructor(e,t){this.form=e,this.resizeObserver=new ResizeObserver(this.onFormResize.bind(this)),this.page=t||e,this.resizeObserver.observe(e),this.updateLayoutOnScroll=this.updateLayoutOnScroll.bind(this),this.page.addEventListener("scroll",this.updateLayoutOnScroll,!0)}clearLayoutHandler(){this.resizeObserver.disconnect(),this.page.removeEventListener("scroll",this.updateLayoutOnScroll,!0),this.layoutHandler=void 0}clipsContentX(e){const{overflow:t,overflowX:i}=e.style;return y.CLIP.includes(t)||y.CLIP.includes(i)}clipsContentY(e){const{overflow:t,overflowY:i}=e.style;return y.CLIP.includes(t)||y.CLIP.includes(i)}getDisplayLabel(e,t){return t?.getAttribute("aria-label")||t?.textContent||e.getAttribute("aria-label")||e.id}getDisplayValue(e,t,i){const s=e.tagName;if(s==="INPUT"){const n=e;return n.type==="checkbox"||n.type==="radio"?n.checked?t:"":n.type==="password"?"*****":String(i)}if(s==="SELECT"){const n=Array.isArray(i)?i:[i];if(!n.length)return String(i);const r=e.options;return typeof n[0]=="number"?n.map(a=>r[a].text).join(`
`):Array.from(r).filter(a=>n.includes(a.value)).map(a=>a.text).join(`
`)}return String(i)}getElements(e){const t=Array.from(this.form.elements);return e.length&&t.push(...Array.from(this.page.querySelectorAll("#"+e.join(",#")))),t}getLabelFor(e){let t=e.id?this.page.querySelector("label[for="+e.id+"]"):void 0;return!t&&e.parentElement?.tagName==="LABEL"&&(t=e.parentElement),!t&&e.previousElementSibling?.tagName==="LABEL"&&(t=e.previousElementSibling),t}getParent(e){return e.parentElement}getPlaceholder(e){return e.getAttribute("placeholder")||""}getRect(e){return(e||this.page).getBoundingClientRect()}getStoreKeys(e){const t=e.getAttribute("name");return t?[t,e.id]:[e.id]}isDisabled(e){if(e.tagName!=="TEXTAREA")return e.disabled;const t=e;return t.disabled||t.readOnly}isHidden(e){return e.hidden}setLayoutHandler(e){this.layoutHandler=e}onFormResize(){this.layoutHandler&&this.layoutHandler.handleLayout()}updateLayoutOnScroll(e){e.target instanceof HTMLElement&&this.layoutHandler&&this.layoutHandler.handleLayout(e.target)}};let I=y;I.CLIP=["auto","hidden","scroll"];class x{constructor(t){if(this.wrapperClass=t,!t)throw new Error("FmmFrameworkItemBase requires wrapperClass")}destructor(){}getEnvelope(t,i,s){let n=i.parentElement;for(;n&&n.tagName!=="FORM"&&!n.classList.contains(this.wrapperClass);)n=n.parentElement;if(n&&n.tagName!=="FORM")return n;if(s){for(n=s.parentElement;n&&n.tagName!=="FORM"&&!n.classList.contains(this.wrapperClass);)n=n.parentElement;return n&&n.tagName!=="FORM"?n:void 0}}getError(t,i,s,n){return""}getLabel(t,i){return i.querySelector("LABEL")||i.querySelector("[aria-label]")}getValue(t,i,s,n){return""}}const F=class extends A{constructor(){super(...arguments);this.listener=this.notifyMinimaps.bind(this)}createStoreItem(e,t){const i=t.tagName;if(i==="INPUT"){const s=t;return F.INPUTTYPES.includes(s.type)?new Q(s,this.listener):void 0}if(i==="SELECT")return new tt(t,this.listener);if(i==="TEXTAREA")return new et(t,this.listener)}getError(e,t,i){return t.fe.validationMessage||t.fe.required&&!t.fe.value&&"Required"||""}getName(e,t){return t.fe.name}getValue(e,t){return t.getValue()}isDisabled(e,t){return e.isDisabled(t.fe)}};let T=F;T.INPUTTYPES=["checkbox","color","date","datetime","datetime-local","email","month","number","password","radio","range","search","tel","text","time","url","week"];class N extends x{constructor(t){super(t)}getError(t,i,s,n){if(!i.classList.contains("is-invalid"))return"";for(let r=i.nextElementSibling;r&&r!==i;r=r.nextElementSibling)if(r.classList.contains("invalid-feedback"))return r.textContent||"";return""}}new N("form-check"),new N("form-group");class C{constructor(t,i,s){this.fe=t,this.event=i,this.listener=s,t.addEventListener(i,s)}destructor(){this.fe.removeEventListener(this.event,this.listener)}getValue(){return this.fe.value||void 0}isDisabled(){return this.fe.disabled}}class Q extends C{constructor(t,i){super(t,"input",i)}}class tt extends C{constructor(t,i){super(t,"change",i);this.e=t,this.isMultiple=t.multiple}getValue(){const t=this.e.selectedIndex;if(t<0)return;if(!this.isMultiple)return[t];const i=[],s=this.e.options;for(let n=s.length;--n>=t;)s[n].selected&&i.push(n);return i.reverse()}}class et extends C{constructor(t,i){super(t,"input",i);this.e=t}}class l{static createMinimap(t,i){if(!t.anchor)throw new Error("FmmMinimap not created: invalid anchor");return new P(i).createMinimap({...t,ordinal:0,usePanelDetail:!1})}static createPanel(t,i,s,n,r){const a="FmmPanel not created: invalid ";if(!t)throw new Error(a+"parent");if(i<1||i>20)throw new Error(a+"minimapsCount");return new P(r,i,!!n,t,s)}static trim(t){return t?.trim().replace(/\u200B/g,"")}}l.CLASS=Object.freeze({Detached:"fmm-detached",DetailPopup:"fmm-detail",Disabled:"fmm-disabled",Error:"fmm-error",Fieldset:"fmm-fieldset",Header:"fmm-header",Invalid:"fmm-invalid",Legend:"fmm-legend",MinimapFrame:"fmm-frame",MinimapPopup:"fmm-popup",Optional:"fmm-optional",Pushpin:"fmm-pushpin",Required:"fmm-required",Title:"fmm-title",Valid:"fmm-valid",Value:"fmm-value"}),l.CSS=`
	circle.fmm-pushpin {
		fill: blue;
	}
	div.fmm-detail,
	div.fmm-popup {
		background-color: darkgray;
		border: 1px solid black;
		box-shadow: 5px 5px lightgray;
		padding-top: 10px;
		z-index: 1;
	}
	div.fmm-disabled {
		background-color: darkgray;
	}
	div.fmm-disabled,
	div.fmm-invalid,
	div.fmm-optional,
	div.fmm-required,
	div.fmm-valid {
		border: 1px solid transparent;
	}
	div.fmm-frame {
		background-color: white;
	}
	div.fmm-header {
		border-bottom: 5px groove;
		margin: 0;
	}
	div.fmm-invalid {
		background-color: red;
	}
	div.fmm-optional {
		border-color: black;
	}
	div.fmm-required {
		border-color: red;
	}
	div.fmm-valid {
		background-color: green;
	}
	fieldset.fmm-fieldset {
		background-color: white;
		border-top: 5px groove;
		min-width: 0;
		padding: 5px 10px;
	}
	fieldset.fmm-fieldset div.fmm-disabled,
	fieldset.fmm-fieldset div.fmm-invalid,
	fieldset.fmm-fieldset div.fmm-optional,
	fieldset.fmm-fieldset div.fmm-required,
	fieldset.fmm-fieldset div.fmm-valid {
		border-width: 2px;
	}
	label.fmm-title {
		font-size: smaller;
		padding: 2px;
	}
	legend.fmm-legend {
		background-color: white;
		margin: 5px;
		max-width: 100%;
		padding-right: 5px;
	}
	textarea.fmm-value {
		height: 3em;
		width: 100%;
	}
	div.fmm-detached.fmm-popup,
	div.fmm-detached div.fmm-detail {
		background-color: lightgray;
	}
	div.fmm-detached.fmm-frame,
	div.fmm-detached div.fmm-frame,
	div.fmm-detached fieldset.fmm-fieldset,
	iv.fmm-detached legend.fmm-legend {
		background-color: lightgray !important;
	}
	`,l.STATUS_CLASS=Object.freeze({Disabled:"fmm-disabled",Invalid:"fmm-invalid",Optional:"fmm-optional",Required:"fmm-required",Valid:"fmm-valid"});class it{constructor(t,i,s){this.parent=s,this.clip=s?.clipRect(t.getRect(i))||t.getRect(i),this.clipX=t.clipsContentX(i),this.clipY=t.clipsContentY(i)}clipRect(t){const i=Math.max(t.left,this.clip.left),s=Math.max(t.top,this.clip.top),n=Math.max(0,(this.clipX?Math.min(t.right,this.clip.right):t.right)-i),r=Math.max(0,(this.clipY?Math.min(t.bottom,this.clip.bottom):t.bottom)-s),a={left:i,top:s,width:n,height:r,right:i+n,bottom:s+r};return n&&r&&this.parent?this.parent.clipRect(a):a}}class st{constructor(t,i){this.debounceMsec=t,this.task=i,this._doTask=this.doTask.bind(this),this.notBeforeMsec=0}destructor(){!this.task||(this.timer&&window.clearTimeout(this.timer),this.timer=void 0)}cancel(){return this.timer?(window.clearTimeout(this.timer),this.timer=void 0,!0):!1}doNow(){!this.task||(this.cancel(),this.task())}schedule(){!this.task||(this.notBeforeMsec=Date.now()+this.debounceMsec,this.timer||(this.timer=window.setTimeout(this._doTask,this.debounceMsec)))}doTask(){const t=this.notBeforeMsec-Date.now();t>0?this.timer=window.setTimeout(this._doTask,t):(this.timer=void 0,this.task())}}class O{constructor(t,i){this.data=g.NULLDATA,this.minimapId=0;const s=this.e=t.createElement("FIELDSET");s.className=l.CLASS.Fieldset;const n=m.ELLIPSIS(t.createElement("LEGEND"));n.className=l.CLASS.Legend,this.status=n.appendChild(t.createElement("DIV")),this.status.style.display="inline-block",this.status.style.margin="3px 6px 0 3px",this.status.style.height="0.7em",this.status.style.width="1em",this.label=n.appendChild(t.createElement("SPAN")),this.label.textContent=m.NBSP,s.appendChild(n),this.value=s.appendChild(t.createElement("TEXTAREA")),this.value.className=l.CLASS.Value,this.value.readOnly=!0,this.error=m.ELLIPSIS(s.appendChild(t.createElement("DIV"))),this.error.className=l.CLASS.Error,this.error.textContent=m.NBSP,i&&i.appendChild(s)}destructor(){this.e.parentElement&&this.e.parentElement.removeChild(this.e)}clear(t){t&&t!==this.data||(this.error.textContent=this.label.textContent=m.NBSP,this.status.className=this.value.placeholder=this.value.value="",this.data=g.NULLDATA)}refreshDisplay(t){if(t!==this.minimapId)return;const i=this.data,s=i.aggregateLabel?.concat(": ")||"";this.error.textContent=this.error.title=i.error||m.NBSP,this.label.textContent=this.label.title=s+i.label||m.NBSP,this.status.className=l.STATUS_CLASS[i.status],this.value.placeholder=i.placeholder||"",this.value.value=i.aggregateValues?.join(`
`)||i.value||""}setDisplay(t,i){this.data=i||g.NULLDATA,this.refreshDisplay(this.minimapId=t)}}const U=class{constructor(e,t,i,s){this.e=t,this.storeItem=i;const n=s.form.getLabelFor(t);this.dynamicLabel=s.dynamicLabels.includes(e),this.form=s.form,this.framework=s.framework?.createFrameworkItem(e,t)||U.DEFAULT_FRAMEWORK,this.envelope=this.framework.getEnvelope(e,t,n)||this.getCommonAncestor(t,n)||t,this.label=n||this.framework.getLabel(e,this.envelope),this.snapshot=new g(e,s)}destructor(){this.framework.destructor(),this.storeItem.destructor()}layoutSnapshot(e,t,i){const s=this.form.getParent(this.envelope);if(!s)return this.snapshot.setRect();const n=(e.get(s)||this.getClipContext(s,e)).clipRect(this.form.getRect(this.envelope));if(!n.width||!n.height)return this.snapshot.setRect();const r=Math.floor((n.left-t.left)*i),a=Math.floor((n.top-t.top)*i),o=Math.max(2,Math.floor(n.height*i)),h=Math.max(2,Math.floor(n.width*i));return this.snapshot.setRect(new DOMRectReadOnly(r,a,h,o))}removeIfDetached(){if(this.form.getParent(this.envelope)){for(let e=this.e;e;e=this.form.getParent(e))if(e===this.envelope)return!1}return this.snapshot.destructor(),this.destructor(),!0}takeSnapshot(e,t){const i=this.snapshot.data,s=i.name;(!i.label||this.dynamicLabel)&&(i.label=l.trim(e.getDisplayLabel(this.e,this.label)||s),i.placeholder=l.trim(this.form.getPlaceholder(this.e)));let n=l.trim(this.framework.getValue(s,this.e,this.envelope,i.label));if(!n){const a=t.getValue(e,this.storeItem);a&&(n=l.trim(e.getDisplayValue(this.e,i.label,a)))}i.value=n;const r=!!n;return r&&i.aggregateValues&&i.aggregateValues.push(n),i.error=l.trim(this.framework.getError(s,this.e,this.envelope,r)||t.getError(e,this.storeItem,r)),t.isDisabled(e,this.storeItem)?this.snapshot.setStatus("Disabled"):r?this.snapshot.setStatus(i.error?"Invalid":"Valid"):this.snapshot.setStatus(i.error?"Required":"Optional"),i}getClipContext(e,t){const i=this.form.getParent(e),s=i?t.get(i)||this.getClipContext(i,t):void 0,n=new it(this.form,e,s);return t.set(e,n),n}getCommonAncestor(e,t){const i=[];for(;t;t=this.form.getParent(t))i.push(t);for(;e&&!i.includes(e);)e=this.form.getParent(e);return e}};let z=U;z.DEFAULT_FRAMEWORK={destructor:()=>{},getEnvelope:(e,t,i)=>{},getError:(e,t,i,s)=>"",getLabel:(e,t)=>{},getValue:(e,t,i,s)=>""};const V=class{constructor(){this.list=[],this.ignore=new WeakSet,this.nameCounter=0}destructor(){this.ignore=new WeakSet,this.list.splice(0).forEach(e=>e.destructor())}compose(e){const t=e.form.getElements(e.customElementIds);this.list.splice(0).forEach(s=>s.removeIfDetached()||this.list.push(s));const i=new WeakSet;this.list.forEach(s=>i.add(s.e)),t.forEach(s=>{if(i.has(s)||this.ignore.has(s))return;if(e.form.isHidden(s))return this.ignore.add(s);const n=e.store.createStoreItem(e.form,s);if(n){const r=e.store.getName(e.form,n)||V.NAMEPREFIX+String(this.nameCounter++);this.list.push(new z(r,s,n,e))}i.add(s)})}layoutSnapshots(e,t,i){this.list.forEach(s=>s.layoutSnapshot(e,t,i))}takeSnapshots(e,t){return this.list.map(i=>i.takeSnapshot(e,t))}};let B=V;B.NAMEPREFIX="$FmmFSI";const _=class{constructor(e,t,i,s){this.dragData="";const n=this.div=e.createElement("DIV");n.className=l.CLASS.MinimapFrame,n.draggable=!0,n.ondragstart=this.onDragStart.bind(this),n.style.cursor="grab",n.style.position="relative";const r=this.header=n.appendChild(e.createElement("DIV"));r.className=l.CLASS.Header,r.style.overflow="hidden",r.style.whiteSpace="nowrap";const a=m.ELLIPSIS(e.createElement("LABEL"));a.className=l.CLASS.Title,a.style.cursor="inherit",a.textContent=a.title=i;const o=t.style;if(s){o.position="absolute",o.top=o.bottom=o.left=o.right="0",_.POSITIONS.includes(s.style.position)||(s.style.position="relative"),s.appendChild(t),this.popup=new L(e,l.CLASS.MinimapPopup,this.div,t);let h=t.previousElementSibling;for(;h&&!h.className.includes("fmm-");)h=h.previousElementSibling;h&&s.removeChild(h),this.setDestroyOnDetachFromDOM(s,t)}else r.appendChild(t),o.display="inline-block",o.margin="1px 2px 0 1px",o.height="0.5em",o.width="0.8em";r.appendChild(a)}destructor(){!this.div.parentElement||(this.detach(),this.popup&&this.popup.destructor(),this.popup=void 0,this.div.onmouseenter=this.div.onmouseleave=null,this.div.parentElement?.removeChild(this.div))}detach(){this.popup?this.div.parentElement?.classList.add(l.CLASS.Detached):this.div.classList.add(l.CLASS.Detached)}newDetailPopup(e,t){return new L(e,l.CLASS.DetailPopup,t.e,this.div)}setSnapshotResult(e){this.dragData=JSON.stringify(e)}onDragStart(e){e.dataTransfer?.setData("text/plain",this.dragData)}setDestroyOnDetachFromDOM(e,t){new MutationObserver((i,s)=>{t.parentElement!==e&&(s.disconnect(),this.destructor())}).observe(e,{childList:!0})}};let H=_;H.POSITIONS=["absolute","fixed","relative","sticky"];const m={ELLIPSIS:e=>(e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",e),NBSP:"\xA0",NOP:()=>{}},b=class{constructor(e,t){this.onUpdateBeingCalled=!1,this.pendingCompose=!1,this.pendingLayout=!1,this.pendingSnapshot=!1;const i=t.ef,s=i.createElement("DIV");this.ordinal=e.ordinal||0,this.summaryData={...g.NULLDATA,label:e.title},this.title=e.title;const n=new H(i,s,this.title,e.anchor);t.add(this,e.anchor?void 0:n.div),n.div.onmouseenter=this.onFrameEnter.bind(this),n.div.onmouseleave=this.onFrameLeave.bind(this),e.anchor&&e.zoomFactor&&n.popup&&n.popup.setZoomable(this,n.header,Math.min(b.MAX_ZOOMFACTOR,Math.max(0,e.zoomFactor))),n.header.onmouseenter=this.onHeaderEnter.bind(this);const r=new rt(i,n.div);this.minimapId=b.idCounter++,this.useWidthToScale=!!e.useWidthToScale,this.verbosity=e.verbosity||0,this.d={clipContextAncestors:new WeakMap,doUpdates:new st(e.debounceMsec||b.DEFAULT_DEBOUNCEMSEC,()=>this.doPendingUpdates()),onUpdate:e.onUpdate||b.ONUPDATE,paramUpdates:{aggregateLabels:e.aggregateLabels||{},aggregateValuesMap:{},customElementIds:[],dynamicLabels:e.dynamicLabels||[],ef:t.ef,form:e.form,framework:e.framework,snapshotUpcall:{hideDetail:this.snapshotHidden.bind(this),showDetail:this.snapshotActive.bind(this)},snapshotsPanel:r,store:e.store||new T},storeItems:new B};const a=e.usePanelDetail&&t.detail||new O(i);this.z={detail:a,detailPopup:a===t.detail?void 0:e.anchor?n.newDetailPopup(i,a):t.newDetailPopup(a),frame:n,panel:t,pin:new nt(i,n.div),snapshotsPanel:r,status:s},e.anchor&&(s.onmouseover=this.onStatusEnter.bind(this)),this.d.paramUpdates.store.notifyMinimapOnUpdate(this,!0),this.d.paramUpdates.form.setLayoutHandler(this)}static ONUPDATE(e){}destructor(){this.detach();const e=this.z;!e||(this.z=void 0,e.status.parentElement?.removeChild(e.status),e.snapshotsPanel.destructor(),e.pin.destructor(),e.frame.destructor(),e.detail.clear(this.activeSnapshot),e.detail!==e.panel.detail&&e.detail.destructor(),e.detailPopup&&e.detailPopup.destructor(),e.panel.remove(this))}compose(e){!this.d||(this.d.paramUpdates.customElementIds=e||[],this.pendingCompose=this.pendingLayout=!0,this.takeSnapshot())}get isDetached(){return this.d===void 0}get isPinned(){return this.z?.pin.isPinned}get isPinnedToPanelDetail(){return this.isPinned&&this.z?.detail===this.z?.panel.detail}detach(){const e=this.d,t=this.z;!e||!t||(this.d=void 0,e.doUpdates.destructor(),this.pendingCompose=this.pendingLayout=!1,this.pendingSnapshot=!0,this.doPendingUpdates(),t.frame.detach(),e.paramUpdates.form.clearLayoutHandler(),e.paramUpdates.store.notifyMinimapOnUpdate(this,!1),e.storeItems.destructor())}handleLayout(e){(!e||this.d?.clipContextAncestors.has(e))&&(this.pendingLayout=!0,this.d?.doUpdates.schedule())}layout(e){const t=this.d,i=this.z;if(!t||!i)return;const s=e&&this.verbosity?Date.now():0,n=t.paramUpdates.form.getRect();if(n?.height&&n.width){t.clipContextAncestors=new WeakMap;const r=i.snapshotsPanel.computeScale(n,i.frame,this.useWidthToScale);i.snapshotsPanel.show(!1),t.storeItems.layoutSnapshots(t.clipContextAncestors,n,r),i.snapshotsPanel.show(!0),e&&(i.pin.trackOff(i.frame),i.pin.trackOn(i.snapshotsPanel,e))}e&&this.verbosity&&console.log("FormMinimap["+this.title+"] Layout(ms)="+String(Date.now()-s))}notifyMinimap(e,t){}onFrameEnter(e){const t=this.z;!t||(this.isPinned||t.pin.trackOn(t.snapshotsPanel,e),this.activeSnapshot&&t.detail.setDisplay(this.minimapId,this.activeSnapshot),this.showPopups())}onFrameLeave(){const e=this.z;!e||this.isPinned||(e.pin.trackOff(e.frame),e.detail.clear(this.activeSnapshot),e.detailPopup?e.detailPopup.hide():e.panel.hideDetailPopup(),e.frame.popup&&e.frame.popup.hide())}onHeaderEnter(e){e.stopPropagation(),!(!this.z||this.isPinned)&&(this.activeSnapshot=void 0,this.z.detail.setDisplay(this.minimapId,this.summaryData))}onStatusEnter(e){e.stopPropagation(),this.z?.frame.popup?.isShowing||this.showPopups()}takeSnapshot(){return this.d?(this.pendingSnapshot=!0,this.d.doUpdates.schedule(),!0):!1}doTakeSnapshot(){const e=this.d,t=this.z;if(!e||!t)return{snapshots:[],status:"Disabled",title:this.title};const i=e.paramUpdates,s=Object.values(i.aggregateValuesMap);s.forEach(o=>o.splice(0));const n=e.storeItems.takeSnapshots(i.form,i.store);s.forEach(o=>o.sort());const r=t.snapshotsPanel.computeStatus();t.status.className=l.STATUS_CLASS[r];const a={};return r!=="Disabled"&&n.filter(o=>o.error&&o.status===r).forEach(o=>a[o.aggregateLabel||o.label]=o.error),this.summaryData.aggregateValues=Object.keys(a).sort().map(o=>o+": "+a[o]),this.summaryData.status=r,{snapshots:n,status:r,title:this.title}}doPendingUpdates(){const e=this.d,t=this.z;if(!e||!t)return;const i=this.verbosity?Date.now():0;this.pendingCompose&&e.storeItems.compose(e.paramUpdates);const s=this.verbosity?Date.now():0;this.pendingLayout&&this.layout();const n=this.verbosity?Date.now():0;let r=n;if(this.pendingSnapshot){const a=this.doTakeSnapshot();t.frame.setSnapshotResult(a),this.verbosity&&(r=Date.now()),t.detail.refreshDisplay(this.minimapId),this.onUpdateBeingCalled||(this.onUpdateBeingCalled=!0,e.onUpdate(a),this.onUpdateBeingCalled=!1)}if(this.verbosity){const a=this.pendingCompose?" Compose(ms)="+String(s-i):"",o=this.pendingLayout?" Layout(ms)="+String(n-s):"",h=this.pendingSnapshot?" Snapshot(ms)="+String(r-n):"";(a||o||h)&&console.log("FormMinimap["+this.title+"]"+a+o+h)}this.pendingCompose=this.pendingLayout=this.pendingSnapshot=!1}showPopups(){const e=this.z;!e||(this.d&&this.d.doUpdates.doNow(),e.frame.popup&&e.frame.popup.show(!0),e.detailPopup?e.detailPopup.show(!1):e.panel.showDetailPopup())}snapshotActive(e){this.isPinned||this.z?.detail.setDisplay(this.minimapId,this.activeSnapshot=e)}snapshotHidden(e,t){const i=this.z;!i||(this.activeSnapshot===t&&(this.activeSnapshot=void 0),i.detail.clear(t),i.pin.trackOff(i.frame,e))}};let w=b;w.DEFAULT_DEBOUNCEMSEC=200,w.MAX_ZOOMFACTOR=5,w.idCounter=0;const q=class{constructor(e=q.EF,t=1,i=!1,s,n){if(this.ef=e,this.minimapsCount=t,this.vertical=i,this.minimaps=[],s){this.detail=new O(this.ef,n),this.popupParent=s.appendChild(this.ef.createElement("DIV"));const r=this.popupParent.style;r.position="relative",n||(this.detailPopup=this.newDetailPopup(this.detail)),this.div=s.appendChild(this.ef.createElement("DIV")),this.div.style.height=this.div.style.width="100%",this.div.style.overflow="hidden",this.div.style.position="relative"}}destructor(){this.detail&&this.detail.destructor(),this.detailPopup&&this.detailPopup.destructor(),this.minimaps.splice(0).forEach(e=>e.destructor())}add(e,t){if(t&&this.div){this.div.appendChild(t),t.style.position="absolute";const i=100/this.minimapsCount;this.vertical?(t.style.top=String(e.ordinal*i)+"%",t.style.height=String(i*.9)+"%",t.style.right=t.style.left="0"):(t.style.left=String(e.ordinal*i)+"%",t.style.width=String(i*.9)+"%",t.style.top=t.style.bottom="0")}this.minimaps[e.ordinal]&&this.minimaps[e.ordinal].destructor(),this.minimaps[e.ordinal]=e}createMinimap(e){const t="FmmMinimap <"+e.title+"> not created: invalid ";if(!e.form)throw new Error(t+"form");if(e.ordinal&&e.ordinal>=this.minimapsCount)throw new Error(t+"ordinal");return new w(e,this)}destroyDetached(){this.minimaps.filter(e=>e.isDetached).forEach(e=>e.destructor())}hideDetailPopup(){this.detailPopup&&!this.minimaps.find(e=>e.isPinnedToPanelDetail)&&this.detailPopup.hide()}newDetailPopup(e){return this.popupParent?new L(this.ef,l.CLASS.DetailPopup,e.e,this.popupParent):void 0}remove(e){delete this.minimaps[e.ordinal]}showDetailPopup(){this.detailPopup&&this.detailPopup.show(!1)}};let P=q;P.EF={createElement:e=>document.createElement(e),createElementNS:(e,t)=>document.createElementNS(e,t)};class L{constructor(t,i,s,n){this.div=n.appendChild(t.createElement("DIV")),this.div.className=i,this.div.style.display="none",this.div.style.position="absolute",this.div.appendChild(s),n.style.overflow="visible",s.style.display="block",s.style.position="relative"}destructor(){this.div.parentElement&&this.div.parentElement.removeChild(this.div)}get isShowing(){return this.div.style.display!=="none"}getElementSize(t){const i=this.div.style;if(i.display!=="none"){const r=this.div.getBoundingClientRect(),a=t.getBoundingClientRect();return[r.height-(a.top-r.top),r.width-(a.left-r.left)]}i.visibility="hidden",i.display="block";const s=this.div.getBoundingClientRect(),n=t.getBoundingClientRect();return i.display="none",i.visibility="visible",[s.height-(n.top-s.top),s.width-(n.left-s.left)]}hide(){this.div.style.display="none"}setZoomable(t,i,s){let n=!1,r=0,a=0;i.style.cursor="zoom-in",i.onclick=o=>{if(o.button===0){if(o.stopPropagation(),!r){const h=this.div.getBoundingClientRect();r=h.height,a=h.width}t.useWidthToScale?this.div.style.width=String(n?a:a*s)+"px":this.div.style.height=String(n?r:r*s)+"px",t.layout(o),n=!n,i.style.cursor=n?"zoom-out":"zoom-in"}}}show(t){const i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),s=Math.max(document.documentElement.clientWidth,window.innerWidth||0),n=this.div.style;if(n.display!=="none")return;n.left=n.bottom="auto",n.right=t?"50%":"105%",n.top=t?"50%":"0",n.visibility="hidden",n.display="block";const r=this.div.getBoundingClientRect();if(r.left<0){n.left=t?"50%":"105%",n.right="auto";const a=this.div.getBoundingClientRect();s-a.left-a.width<r.left&&(n.left="auto",n.right=t?"50%":"105%")}if(r.bottom>i){n.bottom=t?"50%":"0",n.top="auto";const a=this.div.getBoundingClientRect();a.top+a.height-i>r.bottom&&(n.bottom="auto",n.top=t?"50%":"0")}n.visibility="visible"}}class nt{constructor(t,i){this.SIZE=24,this.parentCursor="none",this.pinned=!1;const s="http://www.w3.org/2000/svg",n=i.appendChild(t.createElementNS(s,"svg"));this.svg=n,i.style.overflow="visible",n.setAttribute("height",String(this.SIZE)),n.setAttribute("width",String(this.SIZE));const r=this.SIZE/4,a=n.appendChild(t.createElementNS(s,"circle"));a.setAttribute("class",l.CLASS.Pushpin),a.setAttribute("cx",String(this.SIZE-r)),a.setAttribute("cy",String(r)),a.setAttribute("r",String(r));const o=n.appendChild(t.createElementNS(s,"polygon"));[[this.SIZE/2+1,Math.ceil(r*1.5)],[0,this.SIZE],[Math.ceil(this.SIZE*.6),r*2-1]].forEach(([h,p])=>{const u=this.svg.createSVGPoint();u.x=h,u.y=p,o.points.appendItem(u)}),o.setAttribute("style","fill:black"),n.style.display="none",n.style.position="absolute"}destructor(){this.trackOff()}get isPinned(){return this.pinned}trackOff(t,i){const s=this.svg.parentNode;i&&i!==s||(this.pinned=!1,this.svg.style.display="none",s.onclick=s.onmousemove=null,s.style.cursor=this.parentCursor,t?t.div.appendChild(this.svg):s.removeChild(this.svg))}trackOn(t,i){const s=this.svg.parentNode,n=s.getBoundingClientRect();s.appendChild(this.svg),this.parentCursor=s.style.cursor,this.svg.style.zIndex=String(+s.style.zIndex+1),s.onclick=r=>{if(r.button===0)if(this.pinned)this.pinned=!1,s.style.cursor="none",s.appendChild(this.svg),this.move(r,n);else{if(this.pinned=!0,s.style.cursor=this.parentCursor,t.reparentPushPinToSnapshot(this.svg,r))return;const a=Math.max(1,(r.clientX-n.left)*100/n.width);this.svg.style.left=String(a)+"%";const o=Math.min(95,(n.top+n.height-r.clientY)*100/n.height);this.svg.style.bottom=String(o)+"%"}},s.onmousemove=r=>this.move(r,n),this.move(i,n),s.style.cursor="none",this.svg.style.display="block"}move(t,i){if(this.pinned)return;const s=t.clientX-i.left,n=i.top+i.height-t.clientY;this.svg.style.left=String(Math.min(i.width,Math.max(s,0)))+"px",this.svg.style.bottom=String(Math.min(i.height,Math.max(n,0)))+"px"}}const W=class{constructor(e,t){const i=t.aggregateLabels[e];i&&!(e in t.aggregateValuesMap)&&(t.aggregateValuesMap[e]=[]),this.data={...W.NULLDATA,aggregateLabel:i,aggregateValues:t.aggregateValuesMap[e],name:e},this.upcall=t.snapshotUpcall,this.div=t.ef.createElement("DIV"),this.div.style.position="absolute",this.div.onmouseover=s=>{s.stopPropagation(),this.upcall.showDetail(this.data)},t.snapshotsPanel.addSnapshot(this,this.div),this.destructor=()=>{this.div.onmouseover=null,this.upcall.hideDetail(this.div,this.data),t.snapshotsPanel.removeSnapshot(this,this.div),this.destructor=m.NOP}}destructor(){}reparentPushPin(e,t,i){const s=this.rect;return!s||t<s.left||t>s.left+s.width||i<s.top||i>s.top+s.height?!1:(this.div.appendChild(e),e.style.left=String((t-s.left)*100/s.width)+"%",e.style.bottom=String((s.top+s.height-i)*100/s.height)+"%",!0)}setRect(e){if(this.rect&&e&&this.rect.left===e.left&&this.rect.top===e.top&&this.rect.right===e.right&&this.rect.bottom===e.bottom)return;this.rect=e;const t=this.div.style;return e?(t.left=String(e.left)+"px",t.top=String(e.top)+"px",t.height=String(e.height)+"px",t.width=String(e.width)+"px",t.display="block"):(this.upcall.hideDetail(this.div,this.data),t.display="none")}setStatus(e){this.div.className=l.STATUS_CLASS[this.data.status=e]}};let g=W;g.NULLDATA={aggregateLabel:"",aggregateValues:void 0,error:"",label:"",name:"",placeholder:"",status:"Optional",value:""};class rt{constructor(t,i){this.list=[],this.div=i.appendChild(t.createElement("DIV")),this.div.style.position="relative"}destructor(){this.div.parentElement&&this.div.parentElement.removeChild(this.div),this.list.splice(0).forEach(t=>t.destructor())}addSnapshot(t,i){this.list.push(t),this.div.appendChild(i)}computeScale(t,i,s){if(!this.div.parentElement)return 0;const[n,r]=i.popup?i.popup.getElementSize(this.div):this.getSize(),a=n/t.height,o=r/t.width,h=this.div.parentElement.style,p=this.div.style;if(i.popup||(s=t.height*o<=n),s){const f=String(Math.round(t.height*o))+"px";if(h.width=p.width=String(r)+"px",p.height=f,p.height===f)return o}else{const f=String(Math.round(t.width*a))+"px";if(p.height=String(n)+"px",h.width=p.width=f,h.width===f&&p.width===f)return a}const u=Math.min(a,o);return p.height=String(Math.round(t.height*u))+"px",h.width=p.width=String(Math.round(t.width*u))+"px",u}computeStatus(){let t="Disabled",i,s;const n=this.list;for(let r=n.length;--r>=0;){const a=n[r].data.status;if(a==="Invalid")return a;a!=="Disabled"&&(t=void 0),a==="Required"&&(i=a),a==="Valid"&&(s=a)}return i||t||s||"Optional"}removeSnapshot(t,i){const s=this.list.findIndex(n=>n===t);s<0||(this.list.splice(s,1),this.div.removeChild(i))}reparentPushPinToSnapshot(t,i){const s=this.div.getBoundingClientRect(),n=i.clientX-s.left,r=i.clientY-s.top;return!!this.list.find(a=>a.reparentPushPin(t,n,r))}show(t){this.div.style.display=t?"block":"none"}getSize(){const t=this.div.getBoundingClientRect();if(!this.div.parentElement)return[t.height,t.width];const i=this.div.parentElement.getBoundingClientRect();return[i.height-(t.top-i.top),i.width-(t.left-i.left)]}}const at=({aggregateLabels:e,anchorRef:t,children:i,customElementIds:s,debounceMsec:n,dynamicLabels:r,framework:a,onUpdate:o,ordinal:h,pageRef:p,panelRef:u,storeRef:f,title:ft,usePanelDetail:gt,useWidthToScale:vt,verbosity:St,zoomFactor:yt,...bt},wt)=>{if(i)throw new Error("FmmReactMinimapTag is a contentless tag");const Y=d.default.useRef(null),Et=G=>{let v=G?.parentElement;for(;v&&v.tagName!=="FORM";)v=v.parentElement;if(G&&!v)throw new Error("FmmReactMinimapTag must be used inside a FORM tag");Y.current=v};return E(wt,X("",Y,{aggregateLabels:e,anchorRef:t,customElementIds:s,debounceMsec:n,dynamicLabels:r,framework:a,onUpdate:o,ordinal:h,pageRef:p,panelRef:u,storeRef:f,title:ft,usePanelDetail:gt,useWidthToScale:vt,verbosity:St,zoomFactor:yt})),d.default.createElement("div",{...bt,ref:Et})},ot=d.default.forwardRef(at),lt=({children:e,minimapsCount:t,detailParentRef:i,vertical:s=!1},n)=>{if(e)throw new Error("FmmReactPanelTag is a contentless tag");const r=d.default.useRef(null);return E(n,Z(r,t,i,s)),d.default.createElement("div",{className:"fmm-panel",ref:r},d.default.createElement("style",null,l.CSS))},ht=d.default.forwardRef(lt),dt=({children:e,errors:t,values:i},s)=>{if(e)throw new Error("FmmReactStoreTag is a contentless tag");return E(s,j(i,t)),null},ct=d.default.forwardRef(dt),X=(e,t,i)=>{const s=d.default.useRef(),n=d.default.useRef(null),r=()=>{const a={aggregateLabels:i.aggregateLabels,anchor:i.anchorRef?.current,debounceMsec:i.debounceMsec,dynamicLabels:i.dynamicLabels,form:new I(t.current,i.pageRef?.current),framework:i.framework,onUpdate:i.onUpdate,ordinal:i.ordinal,store:i.storeRef?.current,title:i.title,usePanelDetail:i.usePanelDetail,useWidthToScale:i.useWidthToScale,verbosity:i.verbosity,zoomFactor:i.zoomFactor},o=i.panelRef?.current?M.PANELS.get(i.panelRef.current):void 0;return s.current=o?o.createMinimap(a):l.createMinimap(a),s.current?(n.current={destructor:()=>s.current?.destructor(),takeSnapshot:()=>!!s.current?.takeSnapshot()},()=>{s.current&&s.current.detach(),s.current=void 0}):()=>{}};return D(r),d.default.useEffect(()=>(s.current&&s.current.destructor(),n.current=null,s.current=void 0,r()),[e]),d.default.useEffect(()=>{s.current&&s.current.compose(i.customElementIds)},[i.customElementIds,e,s]),s.current&&s.current.takeSnapshot(),n},Z=(e,t,i,s)=>{const n=d.default.useRef(null);return D(()=>{const r=l.createPanel(e.current,t,i?.current,s,void 0);return n.current={destroyDetached:()=>r.destroyDetached()},M.PANELS.set(n.current,r),()=>{r.destructor(),M.PANELS.delete(n.current)}}),n},j=(e,t)=>{const i=d.default.useRef(new $(e,t));return i.current.update(e,t),i},D=e=>d.default.useEffect(e,[]),E=(e,t)=>d.default.useEffect(()=>{typeof e=="function"?e(t.current):e&&(e.current=t.current)},[e,t]),M={PANELS:new WeakMap},pt={createFrameworkItem(e,t){if(t.tagName==="INPUT"){const i=t.type;if(i==="checkbox"||i==="radio")return k.Check}return t.classList.contains("MuiSelect-nativeInput")?k.Select:k.Other}};class R extends x{constructor(t){super(t||"MuiFormControl-root")}getError(t,i,s,n){return s?.querySelector(".MuiFormHelperText-root")?.textContent||""}}class mt extends R{constructor(){super("MuiFormControlLabel-root")}getLabel(t,i){return i?.querySelector("SPAN.MuiFormControlLabel-label")}}class ut extends R{getValue(t,i,s,n){return i.parentElement?.querySelector("#mui-component-select-"+t)?.textContent||""}}const k={Check:new mt,Select:new ut,Other:new R};c.FmmMaterialUI=pt,c.FmmReactMinimapTag=ot,c.FmmReactPanelTag=ht,c.FmmReactStoreTag=ct,c.useFmmReactMinimap=X,c.useFmmReactPanel=Z,c.useFmmReactStore=j,c.useOnceAfterFirstRender=D,c.useSetRef=E});
