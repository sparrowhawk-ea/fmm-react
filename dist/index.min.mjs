import{__rest as e}from"tslib";import t from"react";import{Fmm as r,FmmStoreImpl as n,FmmFormHTML as o,FmmFrameworkItemHTML as a}from"@eafmm/core";const c=t.forwardRef(((r,n)=>{var{aggregateLabels:o,anchorRef:a,children:c,customElementIds:l,debounceMsec:u,dynamicLabels:i,framework:d,onUpdate:m,pageRef:v,panelRef:p,parentRef:R,storeRef:g,title:b,usePanelDetail:h,useWidthToScale:E,verbosity:w,zoomFactor:S}=r,y=e(r,["aggregateLabels","anchorRef","children","customElementIds","debounceMsec","dynamicLabels","framework","onUpdate","pageRef","panelRef","parentRef","storeRef","title","usePanelDetail","useWidthToScale","verbosity","zoomFactor"]);if(c)throw new Error("FmmReactMinimapTag is a contentless tag");const L=t.useRef(null);return f(n,s("",L,{aggregateLabels:o,anchorRef:a,customElementIds:l,debounceMsec:u,dynamicLabels:i,framework:d,onUpdate:m,pageRef:v,panelRef:p,parentRef:R,storeRef:g,title:b,usePanelDetail:h,useWidthToScale:E,verbosity:w,zoomFactor:S})),t.createElement("div",Object.assign(Object.assign({},y),{ref:e=>{let t=null==e?void 0:e.parentElement;for(;t&&"FORM"!==t.tagName;)t=t.parentElement;if(e&&!t)throw new Error("FmmReactMinimapTag must be used inside a FORM tag");L.current=t}}))})),l=t.forwardRef((({children:e,detailParentRef:n,vertical:o=!1},a)=>{if(e)throw new Error("FmmReactPanelTag is a contentless tag");const c=t.useRef(null);return f(a,i(c,n,o)),t.createElement("div",{className:"fmm-panel",ref:c},t.createElement("style",null,r.CSS))})),u=t.forwardRef((({children:e,errors:t,values:r},n)=>{if(e)throw new Error("FmmReactStoreTag is a contentless tag");return f(n,d(r,t)),null})),s=(e,n,a)=>{const c=t.useRef(),l=t.useRef(null),u=()=>{var e,t,u,s,i;const d={aggregateLabels:a.aggregateLabels,anchor:null===(e=a.anchorRef)||void 0===e?void 0:e.current,debounceMsec:a.debounceMsec,dynamicLabels:a.dynamicLabels,form:new o(n.current,null===(t=a.pageRef)||void 0===t?void 0:t.current),framework:a.framework,onUpdate:a.onUpdate,store:null===(u=a.storeRef)||void 0===u?void 0:u.current,title:a.title,usePanelDetail:a.usePanelDetail,useWidthToScale:a.useWidthToScale,verbosity:a.verbosity,zoomFactor:a.zoomFactor},m=(null===(s=a.panelRef)||void 0===s?void 0:s.current)?v.PANELS.get(a.panelRef.current):void 0;return c.current=m?m.createMinimap(d):r.createMinimap(d,null===(i=a.parentRef)||void 0===i?void 0:i.current),c.current?(l.current={destructor:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.destructor()},takeSnapshot:()=>{var e;return!!(null===(e=c.current)||void 0===e?void 0:e.takeSnapshot())}},()=>{c.current&&c.current.detach(),c.current=void 0}):()=>{}};return m(u),t.useEffect((()=>(c.current&&c.current.destructor(),l.current=null,c.current=void 0,u())),[e]),t.useEffect((()=>{c.current&&c.current.compose(a.customElementIds)}),[a.customElementIds,e,c]),c.current&&c.current.takeSnapshot(),l},i=(e,n,o)=>{const a=t.useRef(null);return m((()=>{const t=r.createPanel(e.current,null==n?void 0:n.current,o,void 0);return a.current={destroyDetached:()=>t.destroyDetached()},v.PANELS.set(a.current,t),()=>{t.destructor(),v.PANELS.delete(a.current)}})),a},d=(e,r)=>{const o=t.useRef(new n(e,r));return o.current.update(e,r),o},m=e=>t.useEffect(e,[]),f=(e,r)=>t.useEffect((()=>{"function"==typeof e?e(r.current):e&&(e.current=r.current)}),[e,r]),v={PANELS:new WeakMap},p={createFrameworkItem(e,t){if("INPUT"===t.tagName){const e=t.type;if("checkbox"===e||"radio"===e)return g.Check}return t.classList.contains("MuiSelect-nativeInput")?g.Select:g.Other}};class R extends a{constructor(e){super(e||"MuiFormControl-root")}getError(e,t,r,n){var o;return(null===(o=null==r?void 0:r.querySelector(".MuiFormHelperText-root"))||void 0===o?void 0:o.textContent)||""}}const g={Check:new class extends R{constructor(){super("MuiFormControlLabel-root")}getLabel(e,t){return null==t?void 0:t.querySelector("SPAN.MuiFormControlLabel-label")}},Select:new class extends R{getValue(e,t,r,n){var o,a;return(null===(a=null===(o=t.parentElement)||void 0===o?void 0:o.querySelector("#mui-component-select-"+e))||void 0===a?void 0:a.textContent)||""}},Other:new R};export{p as FmmMaterialUI,c as FmmReactMinimapTag,l as FmmReactPanelTag,u as FmmReactStoreTag,s as useFmmReactMinimap,i as useFmmReactPanel,d as useFmmReactStore,m as useOnceAfterFirstRender,f as useSetRef};